define("wixCodeInit/utils/urlBuilder",[],function(){"use strict";function a(){for(var a=arguments[0],b=1;b<arguments.length;++b)a=a.replace(/\/$/,"")+"/"+arguments[b].replace(/^\//,"");return a}function b(a){return/^https?:\/\/localhost\/?$/.test(a)}function c(a){return/^\d+\.\d+\.\d+$/.test(a)}function d(a,b){var d=a.lastIndexOf("/");return c(b)?a.substring(0,d+1)+b:a}function e(a,c){var e=a.serviceTopology,f=b(a.santaBase)?e.scriptsLocationMap.santa:a.santaBase;return f=d(f,c),f.replace(e.scriptsDomainUrl+"services/","")}function f(b,c,d,f){var g=c.extensionId,h="//"+g+".",i=b.serviceTopology.wixCloudBaseDomain,j=d?"index.debug.html":"index.html",k="static/wixcode/target/"+j,l=e(b,f);return h+a(i,"_partials",l,k)}function g(a){return Object.keys(a).map(function(b){return encodeURIComponent(b)+"="+encodeURIComponent(a[b])}).join("&")}function h(a,b,c){c=c||{};var d=f(a,b,c.debug,c.runtimeSource),e=!!a.publicModel,h={compId:"wixCode_"+b.appDefinitionId,deviceType:c.isMobileView?"mobile":"desktop",viewMode:e?"site":a.renderFlags.componentViewMode||"preview",instance:b.instance,locale:a.rendererModel.languageCode,cacheKiller:(new Date).getTime().toString(),initialScari:a.rendererModel.wixCodeModel?a.rendererModel.wixCodeModel.signedAppRenderInfo:""};c.sdkSource&&(h.sdkSource=c.sdkSource);var i=g(h);return d+"?"+i}return{buildUrl:h}}),define("wixCodeInit/utils/messageHolder",[],function(){"use strict";function a(){var a=[],b=null;return{sendOrHoldMessage:function(c){b?b(c):a.push(c)},setMessageTarget:function(c){for(b=c;a.length>0;)b(a.shift())}}}return{get:a}}),define("wixCodeInit/utils/iFrameUtils",[],function(){"use strict";function a(a,b){var c=document.createElement("iframe");return c.style.display="none",c.src=a,c.className="wix-code-app",c.setAttribute("data-app-id",b.applicationId),c.setAttribute("data-app-definition-id",b.appDefinitionId),c}function b(a,b){return b.source===a.contentWindow}return{getIFrameForApp:a,isIFrameEvent:b}}),define("wixCodeInit/utils/widgetsPreLoader",[],function(){"use strict";function a(a){if(null===a||"object"!=typeof a)return a;var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function b(a,b,c,d){requirejs(["utils","widgets","wixCode"],function(e,f,g){var h=d(e),i=e.wixUrlParser.parseUrl(h,a),j=i&&i.pageId;if(j){var k=b(f,h,j),l=g.messageBuilder.getExtendedMessage(k,h.rendererModel.wixCodeModel||{});c(l)}})}function c(a,c,d){var e=function(b,c,d){var e=b.appsUtils.getApplications(a.rendererModel.clientSpecMap,[d],c),f=a.rendererModel.routers||{};return b.messageBuilder.loadWidgetsMessage(e,f.configMap)},f=function(b){return new b.SiteData(a,function(){})};b(c,e,d,f)}function d(a,c,d){var e=function(a,b,c){var d={};return d[c]=a.widgetService.getControllersToInit(b,c),a.messageBuilder.initWidgetsMessage(d)},f=function(){return a};b(c,e,d,f)}function e(b,c){if("load_widgets"===c.type){var d=b.widgets.map(function(a){return a.id});if(d.length>0&&(c=a(c),c.widgets=c.widgets.filter(function(a){return-1===d.indexOf(a.id)}),0===c.widgets.length))return null}return c}return{asyncGetPreLoadMessage:c,asyncGetPreInitMessage:d,filterPreLoadedWidgets:e}}),define("wixCodeInit/utils/specMapUtils",[],function(){"use strict";function b(b){for(var c in b)if(b.hasOwnProperty(c)&&b[c].type===a)return b[c]}var a="siteextension";return{getAppSpec:b}}),define("wixCodeInit/api/wixCodeAppApi",["wixCodeInit/utils/urlBuilder","wixCodeInit/utils/messageHolder","wixCodeInit/utils/iFrameUtils","wixCodeInit/utils/widgetsPreLoader","wixCodeInit/utils/specMapUtils"],function(a,b,c,d,e){"use strict";function f(a){return"WIX_CODE"===a.intent&&"wix_code_iframe_loaded"===a.type}function g(a){"loading"!==document.readyState?document.body.appendChild(a):document.addEventListener("DOMContentLoaded",function(){document.body.appendChild(a)})}function h(){function o(a,b){c.isIFrameEvent(a,b)&&(f(b.data)&&j.setMessageTarget(function(b){a.contentWindow.postMessage(b,"*")}),h.forEach(function(a){a(b.data)}))}function p(b,d,f){if(k)return void console.warn("Wix code is already initiated");var h=e.getAppSpec(d);if(h){var i=a.buildUrl(b,h,f),j=c.getIFrameForApp(i,h),l=o.bind(null,j);window.addEventListener("message",l,!1),g(j),k=!0}}function q(a){h.push(a)}function r(a){i.push(a)}function s(a){var b=a;return i.forEach(function(a){b=a(b)}),b}function t(a){l&&(a=m?d.filterPreLoadedWidgets(m,a):a),a&&j.sendOrHoldMessage(s(a)),l=!1}function u(a,b){var c=e.getAppSpec(a.rendererModel.clientSpecMap);l&&!m&&c&&d.asyncGetPreLoadMessage(a,b,function(a){l&&!m&&(m=a,j.sendOrHoldMessage(m))})}function v(a,b){var c=e.getAppSpec(a.rendererModel.clientSpecMap);l&&!n&&c&&d.asyncGetPreInitMessage(a,b,function(a){l&&!n&&(n=a,j.sendOrHoldMessage(n))})}var h=[],i=[],j=b.get(),k=!1,l=!0,m=null,n=null;return{init:p,sendMessage:t,registerMessageHandler:q,registerMessageModifier:r,preLoadWidgets:u,preInitWidgets:v}}return{getApi:h}}),define("wixCodeInit/api/initMainR",["wixCodeInit/utils/specMapUtils"],function(a){"use strict";function b(b,c,d,e){function h(d){b.init(c,d,f),g&&a.getAppSpec(d)&&b.preLoadWidgets(c,document.location.href)}var f={isMobileView:d,debug:e.getParameterByName("debug"),sdkSource:e.getParameterByName("sdkSource"),runtimeSource:e.getParameterByName("WixCodeRuntimeSource")},g=!!c.publicModel;h(c.rendererModel.clientSpecMap)}return b}),define("wixCodeInit",["wixCodeInit/api/wixCodeAppApi","wixCodeInit/api/initMainR","wixCodeInit/utils/specMapUtils"],function(a,b,c){"use strict";return{getAppApi:a.getApi,initMainR:b,specMapUtils:c}});